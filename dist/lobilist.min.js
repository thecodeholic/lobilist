$(function(){var List=function($lobiList,options){function _randomString(n){for(var text="",possible="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;n>i;i++)text+=possible.charAt(Math.floor(Math.random()*possible.length));return text}function _processItemData(item){return $.extend({},me.$globalOptions.itemOptions,item)}function _init(){me.$options.id||(me.$options.id=_randomString(10));var $wrapper=$("<div>",{"class":"lobilist-wrapper"}),$div=$("<div>",{id:me.$options.id,"class":"lobilist"}).appendTo($wrapper);me.$options.defaultStyle&&$div.addClass(me.$options.defaultStyle),me.$el=$div,me.$elWrapper=$wrapper,$header=_createHeader(),$title=_createTitle(),$body=_createBody(),$ul=_createList(),options.items&&_createItems(options.items),$form=_createForm(),$body.append($ul,$form),$footer=_createFooter(),me.$globalOptions.sortable&&_enableSorting()}function _createHeader(){var $header=$("<div>",{"class":"lobilist-header"}),$actions=$("<div>",{"class":"lobilist-actions"}).appendTo($header);return me.$options.controls&&me.$options.controls.length>0&&(me.$options.controls.indexOf("styleChange")>-1&&$actions.append(_createDropdownForStyleChange()),me.$options.controls.indexOf("edit")>-1&&($actions.append(_createEditTitleButton()),$actions.append(_createFinishTitleEditing()),$actions.append(_createCancelTitleEditing())),me.$options.controls.indexOf("add")>-1&&$actions.append(_createAddNewButton()),me.$options.controls.indexOf("remove")>-1&&$actions.append(_createCloseButton())),me.$el.append($header),$header}function _createTitle(){var $title=$("<div>",{"class":"lobilist-title",html:me.$options.title}).appendTo($header);return me.$options.controls&&me.$options.controls.indexOf("edit")>-1&&$title.on("dblclick",function(){me.startTitleEditing()}),$title}function _createBody(){return $("<div>",{"class":"lobilist-body"}).appendTo(me.$el)}function _createForm(){var $form=$("<form>",{"class":"lobilist-add-todo-form hide"});$("<input>",{type:"hidden",name:"id"}).appendTo($form),$("<div>",{"class":"form-group"}).append($("<input>",{type:"text",name:"title","class":"form-control",placeholder:"TODO title"})).appendTo($form),$("<div>",{"class":"form-group"}).append($("<textarea>",{rows:"2",name:"description","class":"form-control",placeholder:"TODO description"})).appendTo($form),$("<div>",{"class":"form-group"}).append($("<input>",{type:"text",name:"dueDate","class":"form-control",placeholder:"Due Date"})).appendTo($form);var $ft=$("<div>",{"class":"lobilist-form-footer"});return $("<button>",{"class":"btn btn-primary btn-sm btn-add-todo",html:"Add"}).appendTo($ft),$("<button>",{type:"button","class":"btn btn-default btn-sm btn-discard-todo",html:'<i class="glyphicon glyphicon-remove-circle"></i>'}).click(function(){$form.addClass("hide"),$footer.removeClass("hide")}).appendTo($ft),$ft.appendTo($form),_formHandler($form),me.$el.append($form),$form}function _formHandler($form){$form.on("submit",function(ev){ev.preventDefault(),_submitForm()})}function _submitForm(){return $form[0].title.value?(me.saveOrUpdateItem({id:$form[0].id.value,title:$form[0].title.value,description:$form[0].description.value,dueDate:$form[0].dueDate.value}),$form.addClass("hide"),void $footer.removeClass("hide")):void _showFormError("title","Title can not be empty")}function _createFooter(){var $footer=$("<div>",{"class":"lobilist-footer"});return $("<button>",{type:"button","class":"btn-link btn-show-form",html:"Add new"}).click(function(){_resetForm(),$form.removeClass("hide"),$footer.addClass("hide")}).appendTo($footer),me.$el.append($footer),$footer}function _createList(){var $list=$("<ul>",{"class":"lobilist-items"});return me.$el.append($list),$list}function _createItems(items){for(var i=0;i<items.length;i++)_addItem(items[i])}function _addItem(item){item.id||(item.id=me.$lobiList.getNextId()),_triggerEvent("beforeItemAdd",[me,item])!==!1&&(item=_processItemData(item),_addItemToList(item))}function _createCheckbox(){var $item=$("<input>",{type:"checkbox"});return $item.change(_onCheckboxChange),$("<label>",{"class":"checkbox-inline lobilist-check"}).append($item)}function _onCheckboxChange(){var $this=$(this);$this.prop("checked")?_triggerEvent("afterMarkAsDone",[me,$this]):_triggerEvent("afterMarkAsUndone",[me,$this]),$this.closest(".lobilist-item").toggleClass("item-done")}function _createDropdownForStyleChange(){for(var $dropdown=$("<div>",{"class":"dropdown"}).append($("<button>",{type:"button","data-toggle":"dropdown","class":"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-th"></i>'})),$menu=$("<div>",{"class":"dropdown-menu dropdown-menu-right"}).appendTo($dropdown),i=0;i<me.$globalOptions.listStyles.length;i++){var st=me.$globalOptions.listStyles[i];$('<div class="'+st+'"></div>').on("mousedown",function(ev){ev.stopPropagation()}).click(function(){me.$el.removeClass(me.$globalOptions.listStyles.join(" ")).addClass(this.className)}).appendTo($menu)}return $dropdown}function _createEditTitleButton(){var $btn=$("<button>",{"class":"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-edit"></i>'});return $btn.click(function(){me.startTitleEditing()}),$btn}function _createAddNewButton(){var $btn=$("<button>",{"class":"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-plus"></i>'});return $btn.click(function(){var list=me.$lobiList.addList();list.startTitleEditing()}),$btn}function _createCloseButton(){var $btn=$("<button>",{"class":"btn btn-default btn-xs",html:'<i class="glyphicon glyphicon-remove"></i>'});return $btn.click(_onRemoveListClick),$btn}function _onRemoveListClick(){return _triggerEvent("beforeListRemove",[me]),me.remove(),_triggerEvent("afterListRemove",[me]),me}function _createFinishTitleEditing(){var $btn=$("<button>",{"class":"btn btn-default btn-xs btn-finish-title-editing",html:'<i class="glyphicon glyphicon-ok-circle"></i>'});return $btn.click(function(){me.finishTitleEditing()}),$btn}function _createCancelTitleEditing(){var $btn=$("<button>",{"class":"btn btn-default btn-xs btn-cancel-title-editing",html:'<i class="glyphicon glyphicon-remove-circle"></i>'});return $btn.click(function(){me.cancelTitleEditing()}),$btn}function _createInput(){var input=$("<input>",{type:"text","class":"form-control"});return input.on("keyup",function(ev){13===ev.which&&me.finishTitleEditing()}),input}function _showFormError(field,error){var $fGroup=$form.find('[name="'+field+'"]').closest(".form-group").addClass("has-error");$fGroup.find(".help-block").remove(),$fGroup.append($("<span>",{"class":"help-block",html:error}))}function _resetForm(){$form[0].reset(),$form[0].id.value="",$form.find(".form-group").removeClass("has-error").find(".help-block").remove()}function _enableSorting(){me.$el.find(".lobilist-items").sortable({connectWith:".lobilist .lobilist-items",items:".lobilist-item",handle:".drag-handler",cursor:"move",placeholder:"lobilist-item-placeholder",forcePlaceholderSize:!0,opacity:.9,revert:70,update:function(event,ui){_triggerEvent("afterItemReorder",[me,ui.item])}})}function _addItemToList(item){var $li=$("<li>",{"data-id":item.id,"class":"lobilist-item"});return $li.append($("<div>",{"class":"lobilist-item-title",html:item.title})),item.description&&$li.append($("<div>",{"class":"lobilist-item-description",html:item.description})),item.dueDate&&$li.append($("<div>",{"class":"lobilist-item-duedate",html:item.dueDate})),$li=_addItemControls($li),item.done&&($li.find("input[type=checkbox]").prop("checked",!0),$li.addClass("item-done")),$li.data("lobiListItem",item),$ul.append($li),_triggerEvent("afterItemAdd",[me,item]),$li}function _addItemControls($li){me.$options.useCheckboxes&&$li.append(_createCheckbox());var $itemControlsDiv=$("<div>",{"class":"todo-actions"}).appendTo($li);return me.$options.enableTodoEdit&&$itemControlsDiv.append($("<div>",{"class":"edit-todo todo-action",html:'<i class="glyphicon glyphicon-pencil"></i>'}).click(function(){me.editItem($(this).closest("li").data("id"))})),me.$options.enableTodoRemove&&$itemControlsDiv.append($("<div>",{"class":"delete-todo todo-action",html:'<i class="glyphicon glyphicon-remove"></i>'}).click(function(){_onDeleteItemClick($(this).closest("li").data("lobiListItem"))})),$li.append($("<div>",{"class":"drag-handler"})),$li}function _onDeleteItemClick(item){me.deleteItem(item)}function _updateItemInList(item){var $li=me.$lobiList.$el.find('li[data-id="'+item.id+'"]');$li.find("input[type=checkbox]").prop("checked",item.done),$li.find(".lobilist-item-title").html(item.title),$li.find(".lobilist-item-description").remove(),$li.find(".lobilist-item-duedate").remove(),item.description&&$li.append('<div class="lobilist-item-description">'+item.description+"</div>"),item.dueDate&&$li.append('<div class="lobilist-item-duedate">'+item.dueDate+"</div>"),$li.data("lobiListItem",item),_triggerEvent("afterItemUpdate",[me,item])}function _triggerEvent(type,data){return me.$options[type]&&"function"==typeof me.$options[type]?me.$options[type].call(me,data):me.$el.trigger(type,data)}function _removeItemFromList(item){me.$lobiList.$el.find("li[data-id="+item.id+"]").remove(),_triggerEvent("afterItemDelete",[me,item])}function _sendAjax(url,params){return $.ajax(url,_beforeAjaxSent(params))}function _beforeAjaxSent(params){var eventParams=_triggerEvent("beforeAjaxSent",[me,params]);return $.extend({},params,eventParams||{})}this.$lobiList=$lobiList,this.$el=null,this.$elWrapper=null,this.$options=options,this.$items=[],this.$globalOptions=$lobiList.$options;var $ul,$header,$title,$form,$footer,$body,me=this;this.addItem=function(item,errorCallback){return _triggerEvent("beforeItemAdd",[me,item])===!1?me:(item=_processItemData(item),me.$globalOptions.actions.insert?$.ajax(me.$globalOptions.actions.insert,{data:item,method:"POST"}).done(function(res){res.success?(item.id=res.id,_addItemToList(item)):errorCallback&&"function"==typeof errorCallback&&errorCallback(res)}):(item.id=me.$lobiList.getNextId(),_addItemToList(item)),me)},this.updateItem=function(item,errorCallback){return _triggerEvent("beforeItemUpdate",[me,item])===!1?me:(me.$globalOptions.actions.update?$.ajax(me.$globalOptions.actions.update,{data:item,method:"POST"}).done(function(res){res.success?_updateItemInList(item):errorCallback&&"function"==typeof errorCallback&&errorCallback(res)}):_updateItemInList(item),me)},this.deleteItem=function(item,errorCallback){return _triggerEvent("beforeItemDelete",[me,item])===!1?me:me.$globalOptions.actions["delete"]?_sendAjax(me.$globalOptions.actions["delete"],{data:item,method:"POST"}).done(function(res){res.success?_removeItemFromList(item):errorCallback&&"function"==typeof errorCallback&&errorCallback(res)}):(_removeItemFromList(item),me)},this.saveOrUpdateItem=function(item,errorCallback){return item.id?me.updateItem(item,errorCallback):me.addItem(item,errorCallback),me},this.startTitleEditing=function(){var input=_createInput();return $title.attr("data-old-title",$title.html()),input.val($title.html()),input.insertAfter($title),$title.addClass("hide"),$header.addClass("title-editing"),input[0].focus(),input[0].select(),me},this.finishTitleEditing=function(){var $input=$header.find("input");return $title.html($input.val()).removeClass("hide").removeAttr("data-old-title"),$input.remove(),$header.removeClass("title-editing"),me},this.cancelTitleEditing=function(){var $input=$header.find("input");return 0===$input.length?me:($title.html($title.attr("data-old-title")).removeClass("hide"),$input.remove(),$header.removeClass("title-editing"),me)},this.remove=function(){return me.$lobiList.$lists.splice(me.$el.index(),1),me.$elWrapper.remove(),me},this.editItem=function(id){var $item=me.$lobiList.$el.find("li[data-id="+id+"]"),$form=$item.closest(".lobilist").find(".lobilist-add-todo-form"),$footer=$item.closest(".lobilist").find(".lobilist-footer");return $form.removeClass("hide"),$footer.addClass("hide"),$form[0].id.value=$item.attr("data-id"),$form[0].title.value=$item.find(".lobilist-item-title").html(),$form[0].description.value=$item.find(".lobilist-item-description").html()||"",$form[0].dueDate.value=$item.find(".lobilist-item-duedate").html()||"",me},_init()},LobiList=function($el,options){function _processInput(options){return options=$.extend({},$.fn.lobiList.DEFAULT_OPTIONS,options),options.actions.load&&$.ajax(options.actions.load,{async:!1}).done(function(res){options.lists=res.lists}),options}function _processListOptions(listOptions){listOptions=$.extend({},me.$options.listsOptions,listOptions);for(var i in me.$options)me.$options.hasOwnProperty(i)&&void 0===listOptions[i]&&(listOptions[i]=me.$options[i]);return listOptions}function _init(){me.$el.addClass("lobilists"),me.$options.onSingleLine&&me.$el.addClass("single-line"),_createLists(),me.$options.sortable?me.$el.sortable({items:".lobilist-wrapper",handle:".lobilist-header",cursor:"move",placeholder:"lobilist-placeholder",forcePlaceholderSize:!0,opacity:.9,revert:70,update:function(event,ui){_triggerEvent("afterListReorder",[me,ui.item.find(".lobilist").data("lobiList")])}}):me.$el.addClass("no-sortable"),_triggerEvent("init",[me])}function _createLists(){for(var i=0;i<me.$options.lists.length;i++)me.addList(me.$options.lists[i])}function _triggerEvent(type,data){return me.$options[type]&&"function"==typeof me.$options[type]?me.$options[type].apply(me,data):me.$el.trigger(type,data)}this.$el=null,this.$lists=[],this.$options={};var me=this,_nextId=1;this.addList=function(list){return list instanceof List||(list=new List(me,_processListOptions(list))),_triggerEvent("beforeListAdd",[me,list])!==!1&&(me.$lists.push(list),me.$el.append(list.$elWrapper),list.$el.data("lobiList",list),_triggerEvent("afterListAdd",[me,list])),list},this.destroy=function(){if(_triggerEvent("beforeDestroy",[me])!==!1){for(var i=0;i<me.$lists.length;i++)me.$lists[i].remove();me.$options.sortable&&me.$el.sortable("destroy"),me.$el.removeClass("lobilists"),me.$options.onSingleLine&&me.$el.removeClass("single-line"),me.$el.removeData("lobiList"),_triggerEvent("afterDestroy",[me])}return me},this.getNextId=function(){return _nextId++},this.$el=$el,this.$options=_processInput(options),_init()};$.fn.lobiList=function(option){var ret,args=arguments;return this.each(function(){var $this=$(this),data=$this.data("lobiList"),options="object"==typeof option&&option;data||$this.data("lobiList",data=new LobiList($this,options)),"string"==typeof option&&(args=Array.prototype.slice.call(args,1),ret=data[option].apply(data,args))})},$.fn.lobiList.DEFAULT_OPTIONS={listStyles:["lobilist-default","lobilist-danger","lobilist-success","lobilist-warning","lobilist-info","lobilist-primary"],listsOptions:{id:!1,title:"",items:[]},itemOptions:{id:!1,title:"",description:"",dueDate:"",done:!1},lists:[],actions:{load:"",update:"",insert:"","delete":""},useCheckboxes:!0,enableTodoRemove:!0,enableTodoEdit:!0,sortable:!0,controls:["edit","add","remove","styleChange"],defaultStyle:"lobilist-default",onSingleLine:!0,init:null,beforeDestroy:null,afterDestroy:null,beforeListAdd:null,afterListAdd:null,beforeListRemove:null,afterListRemove:null,beforeItemAdd:null,afterItemAdd:null,beforeItemUpdate:null,afterItemUpdate:null,beforeItemDelete:null,afterItemDelete:null,afterListReorder:null,afterItemReorder:null,afterMarkAsDone:null,afterMarkAsUndone:null,beforeAjaxSent:null}});